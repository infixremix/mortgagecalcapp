<html>
<head>
    <link rel="stylesheet" href="bootstrap-min.css">
    <script src="calculator.js"></script>
    <script src="papaparse.js"></script>
    <script src="save.js"></script>
</head>
<body>
<div class="container mt-5">
    <div class="row">
        <div class="col-lg-6">
            <h2>Mortgage Calculator</h2>
            <form>
                <div class="form-group">
                    <label for="loanAmount">Loan Amount (£)</label>
                    <input type="number" class="form-control" id="loanAmount" placeholder="Enter loan amount" required>
                </div>
                <div class="form-group">
                    <label for="interestRate">Interest Rate (%)</label>
                    <input type="number" class="form-control" id="interestRate" placeholder="Enter interest rate" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="loanTerm">Loan Term (years)</label>
                    <input type="number" class="form-control" id="loanTerm" placeholder="Enter loan term" required>
                </div>
                <div class="form-group">
                    <label for="paymentFrequency">Payment Frequency</label>
                    <select class="form-control" id="paymentFrequency">
                        <option value="monthly">Monthly</option>
                        <option value="biweekly">Bi-Weekly</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" class="form-control" id="startDate" placeholder="Enter start date" required>
                </div>
                <button type="button" class="btn btn-primary" onclick="calculate()">Calculate</button>
                <button type="button" class="btn btn-primary" onclick="loadData() ">Load Data</button>
                <button type="button" class="btn btn-primary" onclick="saveData() ">Save Data</button>
                <button onclick="exportToCSV()">Export to CSV</button>
            </form>
            <div id="totalPayments"></div>
        </div>
        <div class="col-lg-6">
            <h2>Payment Schedule</h2>
            <table class="table table-striped" id="paymentSchedule">
                <thead>
                <tr>
                    <th>Payment Date</th>
                    <th>Payment Amount (£)</th>
                    <th>Principal Paid (£)</th>
                    <th>Interest Paid (£)</th>
                    <th>Balance (£)</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <div id="totalPayments"></div>
        </div>
    </div>
    <script>
    function exportToCSV() {
      // Get the payment schedule table
      var paymentSchedule = document.getElementById("paymentSchedule");

      // Convert the table to CSV using Papa Parse
      var csv = Papa.unparse(paymentSchedule);

      // Download the CSV file
      var csvData = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      var link = document.createElement("a");
      link.href = URL.createObjectURL(csvData);
      link.setAttribute("download", "payment_schedule.csv");
      document.body.appendChild(link);
      link.click();

      // Android-specific code to handle file download
      if (navigator.userAgent.indexOf("Android") > -1) {
          window.Android.downloadFile(link.href, link.getAttribute("download"));
          document.body.removeChild(link);
      }
    }
  </script>
</div>
</body>
</html>